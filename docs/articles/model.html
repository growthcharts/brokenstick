<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Model formulation • brokenstick</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Model formulation">
<meta property="og:description" content="brokenstick">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brokenstick</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.75.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gettingstarted.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/knotplacement.html">Knot placement</a>
    </li>
    <li>
      <a href="../articles/mainfunctions.html">Overview of main functions</a>
    </li>
    <li>
      <a href="../articles/model.html">Model formulation</a>
    </li>
    <li>
      <a href="../articles/oldfriends.html">Help for old friends</a>
    </li>
    <li>
      <a href="../articles/perfectmodel.html">Check perfect model</a>
    </li>
    <li>
      <a href="../articles/prediction.html">Fit and predict</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stefvanbuuren/brokenstick/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="model_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Model formulation</h1>
                        <h4 class="author">Stef van Buuren</h4>
            
            <h4 class="date">2020-09-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stefvanbuuren/brokenstick/blob/master/vignettes/model.Rmd"><code>vignettes/model.Rmd</code></a></small>
      <div class="hidden name"><code>model.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This vignette provides the formal definition and interpretation of the broken stick model.</p>
</div>
<div id="notation" class="section level2">
<h2 class="hasAnchor">
<a href="#notation" class="anchor"></a>Notation</h2>
<p>We adopt the notation of <span class="citation">Fitzmaurice, Laird, and Ware (2011)</span>. Let <span class="math inline">\(Y_{ij}\)</span> denote the response variable for the <span class="math inline">\(i^{\rm th}\)</span> subject on the <span class="math inline">\(j^{\rm th}\)</span> measurement occasion at time <span class="math inline">\(t_{ij}\)</span>. Data are collected in a sample of <span class="math inline">\(N\)</span> persons <span class="math inline">\(i=1,\dots,N\)</span>. Let repeated measurements for the <span class="math inline">\(i^{\rm th}\)</span> subject be grouped as <span class="math display">\[ Y_i = \left( \begin{array} {l} Y_{i1} \\ Y_{i2} \\ \vdots \\ Y_{in_i} \end{array} \right), \quad i = 1, \dots, N.\]</span> If the measures have been observed at a common same set of occasions, then we could drop the index <span class="math inline">\(i\)</span> in <span class="math inline">\(t_{ij}\)</span> since <span class="math inline">\(t_{ij} = t_j\)</span> for all <span class="math inline">\(i = 1, \dots, N\)</span>. Here we will focus on the case that <span class="math inline">\(t_{ij}\)</span> varies over <span class="math inline">\(i\)</span>.</p>
<p>In addition, let use define the <span class="math inline">\(n_i \times p\)</span> matrices <span class="math display">\[ X_i = \left( \begin{array} {llll} 
 X_{i11} &amp; X_{i12} &amp; \cdots &amp; X_{i1p} \\
 X_{i21} &amp; X_{i22} &amp; \cdots &amp; X_{i2p} \\
 \vdots  &amp; \vdots  &amp; \ddots &amp; \vdots  \\
 X_{in_i1} &amp; X_{in_i2} &amp; \cdots &amp; X_{in_ip}
\end{array} \right), \quad i = 1, \dots, N,\]</span> so that the rows of <span class="math inline">\(X_i\)</span> contain <span class="math inline">\(p\)</span> covariates associated with the responses at <span class="math inline">\(n_i\)</span> measurement occasions. The columns may be time-varying covariates. If a certain covariate is fixed in time (e.g. sex, treatment, education), then all within the corresponding column in <span class="math inline">\(X_i\)</span> are identical.</p>
</div>
<div id="broken-stick-model" class="section level2">
<h2 class="hasAnchor">
<a href="#broken-stick-model" class="anchor"></a>Broken stick model</h2>
<p>The broken stick model avoids modeling observation times <span class="math inline">\(t_{ij}\)</span> directly by representing each <span class="math inline">\(t_{ij}\)</span> as its relative position within a time interval. For example, suppose <span class="math inline">\(t_{ij} = 0.6\)</span> years and that the time interval is given by 0.5-1.0 years. The position relative to the left break age is <span class="math inline">\(x_{\rm left} = (1.0-0.6)/(1.0-0.5) = 0.8\)</span>, whereas relative to the right break age is <span class="math inline">\(x_{\rm right} = (0.6-0.5)/(1.0-0.5) = 0.2\)</span>. In order to fit the broken stick model, we need to replace time point <span class="math inline">\(t_{ij} = 0.6\)</span> by two values: 0.8 (for break age 0.5), and 0.2 (for break age 1.0). Note that both values add up to 1. Coding time in this way simplifies modeling continuous time by a set of discrete break ages.</p>
<p>More specifically, let <span class="math inline">\(t_{ij}\)</span> be coded by a second order (linear) B-spline using <span class="math inline">\(k\)</span> internal knots <span class="math inline">\(\kappa\)</span> placed at <span class="math inline">\(k+1\)</span> ordered ages <span class="math display">\[
\kappa_0 = \kappa_1 &lt; \dots &lt; \kappa_k &lt; \kappa_{k+1}
\]</span> The internal knots <span class="math inline">\(\kappa_1, \dots, \kappa_k\)</span> correspond to the set of ages for which we obtain broken stick estimates, and it could be specified by the user. The left boundary knot <span class="math inline">\(\kappa_0 = \kappa_1\)</span> is conveniently set to the minimum age <span class="math inline">\(\min(t_{ij})\)</span> in the data, whereas the right hand boundary knot <span class="math inline">\(\kappa_{k+1} \geq \max(t_{ij})\)</span>.</p>
<p>The second order B-spline <span class="citation">(De Boor 1978, 32)</span>, <span class="math display">\[
H_s(t) = \left\{ \begin{array} {l@{\quad,\quad}l}
(t-\kappa_{s-1})/(\kappa_s - \kappa_{s-1}) &amp; \kappa_{s-1} &lt; t \leq \kappa_s,\\
(\kappa_{s+1}-t)/(\kappa_{s+1} - \kappa_s) &amp; \kappa_s \leq t &lt; \kappa_{s+1},\\
0 &amp; {\rm otherwise.}
\end{array} \right. 
\]</span> is applied to <span class="math inline">\(t_{ij}\)</span> to obtain <span class="math inline">\((k+1)\)</span> transformed variables <span class="math inline">\(x_{is} = t_{ij}\)</span> with <span class="math inline">\(s = 1,\dots,k+1\)</span>. These variables can conveniently be grouped into the <span class="math inline">\(n_i \times (k+1)\)</span> matrix of covariates <span class="math inline">\(X_i = (x_{i1}, \dots, x_{ik}, x_{i(k+1)})\)</span>. Each row in <span class="math inline">\(X_i\)</span> has only one or two non-zero elements, which sum to 1.</p>
<p>Using this <span class="math inline">\(X_i\)</span>, the broken stick model is a special case (with <span class="math inline">\(Z_i = X_i\)</span>) of the two-stage random-effects model <span class="citation">(Laird and Ware 1982)</span></p>
<p><span class="math display">\[
Y_i = X_i\beta + X_ib_i + \epsilon_i
\]</span></p>
<p>where the <span class="math inline">\(k+1\)</span> column vector <span class="math inline">\(\beta\)</span> contains <span class="math inline">\(k+1\)</span> fixed effect coefficients common to all persons, where the <span class="math inline">\(k+1\)</span> column vector <span class="math inline">\(b_i\)</span> accomodates for <span class="math inline">\(k+1\)</span> subject-specific random parameters, and where the <span class="math inline">\(n_i\)</span> column vector <span class="math inline">\(\epsilon_i\)</span> holds subject-specific residuals.</p>
<p>In order to complete the model specification, we assume that the residuals are identically and independently distributed as <span class="math inline">\(\epsilon_i \sim N(0,\sigma^2 I(n_i))\)</span>, where <span class="math inline">\(\sigma^2\)</span> is a common variance parameter, and where <span class="math inline">\(I(n_i)\)</span> is the identity matrix of order <span class="math inline">\(n_i\)</span>. Thus, the equation represents population parameters (fixed effects), individual effects (random effects), and an amount of within-person dispersion that is the same for all persons.</p>
<p>At the person level, we assume <span class="math inline">\(b_i \sim N(0, \Omega)\)</span>, i.e., the random coefficients of the subjects have a multivariate normal distribution with zero mean and a <span class="math inline">\((k+1) \times (k+1)\)</span> covariance matrix <span class="math inline">\(\Omega\)</span>. In addition, we assume that the covariance between <span class="math inline">\(b_i\)</span> and <span class="math inline">\(\epsilon_i\)</span> is zero.</p>
<p>In summary, given the knot specification and the choice of the response scale, the parameters of the broken stick model are:</p>
<ul>
<li>
<span class="math inline">\(\beta\)</span>, a vector of <span class="math inline">\(k + 1\)</span> fixed parameters;</li>
<li>
<span class="math inline">\(\Omega\)</span>, a <span class="math inline">\((k+1) \times (k+1)\)</span> covariance matrix of the random effects;</li>
<li>
<span class="math inline">\(\sigma^2\)</span>, the within-person error variance.</li>
</ul>
<p>The total number of parameters for a solution with <span class="math inline">\(k\)</span> internal knots is thus equal to <span class="math inline">\((k^2 + 5k + 6)/2\)</span>. For example, a model of <span class="math inline">\(k = 3\)</span> knots (i.e. with two connected lines) has 15 parameters, a model with <span class="math inline">\(k = 4\)</span> has 21 parameters, and a model with <span class="math inline">\(k = 10\)</span> break ages has 78 parameters.</p>
</div>
<div id="interpretation" class="section level2">
<h2 class="hasAnchor">
<a href="#interpretation" class="anchor"></a>Interpretation</h2>
<p>Interpretation of the broken stick model is as follows. The sum <span class="math inline">\(\gamma_{is} = \beta_s + b_{is}\)</span> is the <em>conditional</em> (or subject-specific) mean of <span class="math inline">\(Y_i\)</span> at age <span class="math inline">\(\kappa_s\)</span>, <span class="math inline">\(s = 1,\dots, k\)</span>. The set of <span class="math inline">\(\gamma_{is}\)</span> parameters describes the mean response profile for any individual as <span class="math inline">\(k-1\)</span> lines that connect at the <span class="math inline">\(k\)</span> coordinates <span class="math inline">\((\kappa_k, \gamma_{is})\)</span>.</p>
<p>The model effectively represents the <span class="math inline">\(n_i\)</span> measurements of subject <span class="math inline">\(i\)</span> by <span class="math inline">\(k\)</span> new points. The analysis of the <span class="math inline">\(k\)</span> data points at ages <span class="math inline">\(\kappa\)</span> is generally easier than the analysis of <span class="math inline">\(n_i\)</span> values when <span class="math inline">\(t_{ij}\)</span> differs across persons.</p>
<p>If <span class="math inline">\(n_i &gt;&gt; k\)</span> then the broken stick model provides a parsimonious representation of the measurements. Reversely, if <span class="math inline">\(n_i &lt;&lt; k\)</span> then the model infers plausible values for subject <span class="math inline">\(i\)</span> by building strength across persons. The major advantage of the broken stick model is that it converts <span class="math inline">\(n_i\)</span> irregularly observed measurements into a new set of <span class="math inline">\(k\)</span> values <span class="math inline">\(\gamma_{is}\)</span> at common ages <span class="math inline">\(\kappa_1, ..., \kappa_k\)</span>, <span class="math inline">\(s = 1,\dots, k\)</span>.</p>
<p>Since each row in <span class="math inline">\(X_i\)</span> sums to unity, the broken stick model does not have an intercept term. The linear B-spline coding effectively replaces the conventional random intercept term by <span class="math inline">\(k\)</span> <em>local intercepts</em>, one at each break age. The local intercept summarizes the information available in the adjacent left and right age intervals, and ignores any information beyond the adjacent knots. The broken stick estimates are primarily local estimates. Data beyond the adjacent age intervals influence broken stick estimates only through the subject-level part of the model.</p>
<div id="refs" class="references">
<div id="ref-deboor1978">
<p>De Boor, C. 1978. <em>A Practical Guide to Splines</em>. New York: Springer-Verlag.</p>
</div>
<div id="ref-fitzmaurice2011">
<p>Fitzmaurice, G. M, N. M. Laird, and J. H. Ware. 2011. <em>Applied Longitudinal Analysis. Second Edition.</em> New York: John Wiley &amp; Sons.</p>
</div>
<div id="ref-laird1982">
<p>Laird, N. M., and J. H. Ware. 1982. “Random-Effects Models for Longitudinal Data.” <em>Biometrics</em> 38 (4): 963–74.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stef van Buuren.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
