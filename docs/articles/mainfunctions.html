<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Overview of main functions â€¢ brokenstick</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Overview of main functions">
<meta property="og:description" content="brokenstick">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">brokenstick</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.62.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/gettingstarted.html">Getting started with `brokenstick`</a>
    </li>
    <li>
      <a href="../articles/knotplacement.html">Knot placement</a>
    </li>
    <li>
      <a href="../articles/mainfunctions.html">Overview of main functions</a>
    </li>
    <li>
      <a href="../articles/model.html">Model formulation</a>
    </li>
    <li>
      <a href="../articles/perfectmodel.html">Check perfect model</a>
    </li>
    <li>
      <a href="../articles/prediction.html">Fit and predict</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Overview of main functions</h1>
                        <h4 class="author">Stef van Buuren</h4>
            
            <h4 class="date">2020-05-14</h4>
      
      
      <div class="hidden name"><code>mainfunctions.Rmd</code></div>

    </div>

    
    
<div id="objective" class="section level2">
<h2 class="hasAnchor">
<a href="#objective" class="anchor"></a>Objective</h2>
<p>This vignette demonstrates three major functions in the <code>brokenstick</code> package: <code><a href="../reference/brokenstick.html">brokenstick()</a></code>, <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> and <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code>.</p>
</div>
<div id="set-up-libraries" class="section level2">
<h2 class="hasAnchor">
<a href="#set-up-libraries" class="anchor"></a>Set up libraries</h2>
<p>This vignette uses functions from the `<code>brokenstick</code> packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">brokenstick</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">dplyr</span>)</pre></body></html></div>
</div>
<div id="plot-trajectories" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-trajectories" class="anchor"></a>Plot trajectories</h2>
<p>The <code>smocc_200</code> data in the <code>brokenstick</code> package contain the heights of 200 Dutch children measured on 10 visits at ages 0-2 years.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">data</span> <span class="kw">&lt;-</span> <span class="kw pkg">brokenstick</span><span class="kw ns">::</span><span class="no"><a href="../reference/smocc_200.html">smocc_200</a></span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">data</span>, <span class="fl">3</span>)</pre></body></html></div>
<pre><code>## # A tibble: 3 x 7
##   subjid    age sex       ga    bw   hgt hgt.z
##    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  10001 0      female    40  3960  52   0.575
## 2  10001 0.0821 female    40  3960  55.6 0.888
## 3  10001 0.159  female    40  3960  58.2 0.797</code></pre>
<p>We fit a trivial broken stick model and then plot the trajectories of three selected children as follows:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">svglite</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/brokenstick.html">brokenstick</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">hgt</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">age</span>, <span class="kw">subjid</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">subjid</span>)
<span class="no">ids</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10001</span>, <span class="fl">10005</span>, <span class="fl">10022</span>)
<span class="no">fn</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(<span class="kw">fileext</span> <span class="kw">=</span> <span class="st">".svg"</span>)
<span class="fu"><a href="https://rdrr.io/pkg/svglite/man/svglite.html">svglite</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="no">fn</span>, <span class="kw">height</span> <span class="kw">=</span> <span class="fl">3</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">7</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit</span>, <span class="kw">ids</span> <span class="kw">=</span> <span class="no">ids</span>, <span class="kw">zband</span> <span class="kw">=</span> <span class="fl">FALSE</span>, <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"Length (cm)"</span>)</pre></body></html></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>()</pre></body></html></div>
<pre><code>## quartz_off_screen 
##                 2</code></pre>
<div class="figure" style="text-align: center">
<img src="../../../../../../../private/var/folders/py/58s36gjn5kn9zw6rfr7mnx680000gn/T/RtmpLYw8ip/file18120747a2c2d.svg" alt="Het bijschrift"><p class="caption">
Het bijschrift
</p>
</div>
<p>The plots gain more resolution when the Standard Deviation Scores (SDS) (or <span class="math inline">\(Z\)</span>-values) are plotted. The column <code>hgt.z</code> contains the <span class="math inline">\(Z\)</span>-scores of height relative to the WHO standard.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">fit0</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/brokenstick.html">brokenstick</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">hgt.z</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">age</span>, <span class="kw">subjid</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">subjid</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit0</span>, <span class="kw">ids</span> <span class="kw">=</span> <span class="no">ids</span>)</pre></body></html></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="mainfunctions_files/figure-html/zscore-1.png" width="672"></p>
</div>
<div id="fit-broken-stick-model-with-two-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#fit-broken-stick-model-with-two-lines" class="anchor"></a>Fit broken stick model with two lines</h2>
<p>The <em>broken stick model</em> describes a trajectory by a series of connected straight lines. We first calculate a rough approximation in the above trajectories using just two lines. The first line starts at birth and end at the age of exactly 1 years. The second line spans the period between 1 to 2 years. In addition, the lines must connect at the age of 1 year. We estimate this model as follows:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">fit2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/brokenstick.html">brokenstick</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">hgt.z</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">age</span>, <span class="kw">subjid</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">subjid</span>, <span class="kw">knots</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">2</span>)</pre></body></html></div>
<p>The fitted model can now be plotted by</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit2</span>, <span class="kw">ids</span> <span class="kw">=</span> <span class="no">ids</span>, <span class="kw">x_trim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2</span>))</pre></body></html></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="mainfunctions_files/figure-html/plotfit2-1.png" width="672"></p>
<p>The fixed effects correspond to the mean of sample of children in the data, whereas the correlation between ages is modelled by the random effects. The interpretation of the estimates is discussed in the <a href="prediction.html">vignette for prediction</a>.</p>
</div>
<div id="extend-to-nine-lines" class="section level2">
<h2 class="hasAnchor">
<a href="#extend-to-nine-lines" class="anchor"></a>Extend to nine lines</h2>
<p>The plot shows that the two-line model is fairly crude. We now refine the model in the first two years by adding a knot for each age at which a visit was scheduled. This model can be run as</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="co"># 10 scheduled visits</span>
<span class="no">knots</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">24</span>)/<span class="fl">12</span>, <span class="fl">4</span>)
<span class="no">fit9</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/brokenstick.html">brokenstick</a></span>(<span class="kw">y</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">hgt.z</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">age</span>, <span class="kw">subjid</span> <span class="kw">=</span> <span class="no">data</span>$<span class="no">subjid</span>, <span class="kw">knots</span> <span class="kw">=</span> <span class="no">knots</span>)</pre></body></html></div>
<p>The model contains 11 random effects. This optimization problem is more difficult, so it takes longer to run. In addition, it is common that the optimization routines issue a number of warnings related to the number of random effects relative to the number of observations. In general, these warnings do not seem to affect the quality of the solution.</p>
<p>As before, the observed and fitted trajectories can be plotted by</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">fit9</span>, <span class="kw">ids</span> <span class="kw">=</span> <span class="no">ids</span>, <span class="kw">x_trim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">2.2</span>))</pre></body></html></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="mainfunctions_files/figure-html/plotfit9-1.png" width="672"></p>
<p>The broken stick model now fits the observed data quite close.</p>
</div>
<div id="obtain-predicted-values" class="section level2">
<h2 class="hasAnchor">
<a href="#obtain-predicted-values" class="anchor"></a>Obtain predicted values</h2>
<p>The <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function allows us to obtain various types of predictions from the broken stick model. The simplest call</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">fit2</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">p1</span>, <span class="fl">4</span>)</pre></body></html></div>
<pre><code>##   subjid      x     y      yhat  knot
## 1  10001 0.0000 0.575 0.7200512 FALSE
## 2  10001 0.0821 0.888 0.6598649 FALSE
## 3  10001 0.1588 0.797 0.6036372 FALSE
## 4  10001 0.2546 0.661 0.5334077 FALSE</code></pre>
<p>produces the predicted value (in <code>yhat</code>) for each measured data point for all children used to fit the model in the <code>long</code> output format. The observed <span class="math inline">\(Z\)</span>-score is stored in column called <code>y</code>, and the corresponding broken stick estimates are stored in the column called <code>yhat</code>. The column <code>knot</code> is set to <code>FALSE</code> if <code>y</code> is actually observed.</p>
<p>We can obtain the locations at which the lines connect (i.e.Â at the knots) by specifying the <code>at = "knots"</code> argument, e.g.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">fit2</span>, <span class="kw">at</span> <span class="kw">=</span> <span class="st">"knots"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">p2</span>, <span class="fl">4</span>)</pre></body></html></div>
<pre><code>##   subjid      x  y        yhat knot
## 1  10001 0.0000 NA  0.72005117 TRUE
## 2  10001 1.0000 NA -0.01303405 TRUE
## 3  10001 2.0000 NA  0.06603225 TRUE
## 4  10001 2.6776 NA -0.01968604 TRUE</code></pre>
<p>Note that the column <code>knot</code> is now <code>TRUE</code>. Note there are also knots at ages 0.00 and 2.68 years. These are boundary knots, and added by the <code><a href="../reference/brokenstick.html">brokenstick()</a></code> function. By default, the boundary knots span the age range in the data. The estimate for the knot at the maximum age has no useful interpretation. We may obtain estimates at both knots and observed ages by setting <code>at = "both"</code>.</p>
</div>
<div id="explained-variance" class="section level2">
<h2 class="hasAnchor">
<a href="#explained-variance" class="anchor"></a>Explained variance</h2>
<p>The proportion of the variance of the outcome explained by the two-line model is</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="fu"><a href="../reference/get_pev.html">get_pev</a></span>(<span class="no">fit2</span>)</pre></body></html></div>
<pre><code>## [1] 0.7856019</code></pre>
<p>For the second model we get</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="../reference/get_pev.html">get_pev</a></span>(<span class="no">fit9</span>)</pre></body></html></div>
<pre><code>## [1] 0.9128698</code></pre>
<p>so the nine-line broken stick model explains about 91 percent of the variance of the height SDS.</p>
</div>
<div id="subject-level-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#subject-level-analysis" class="anchor"></a>Subject level analysis</h2>
<p>Suppose we are interest in knowing the effect of sex, gestational age and birth weight on the height SDS at the age of 2 years. This is an analysis at the subject level. Let us first extract the subject-level data with variables that vary over subjects only.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">subj</span> <span class="kw">&lt;-</span> <span class="no">data</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">subjid</span>, <span class="no">sex</span>, <span class="no">ga</span>, <span class="no">bw</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">subjid</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span>(<span class="fl">1L</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">subj</span>, <span class="fl">3</span>)</pre></body></html></div>
<pre><code>## # A tibble: 3 x 4
## # Groups:   subjid [3]
##   subjid sex       ga    bw
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1  10001 female    40  3960
## 2  10002 male      38  3210
## 3  10003 female    40  4170</code></pre>
<p>We also need the outcome variable. We take it from the broken stick estimates from the nine line solution and append it to the subject level data.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">bs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="no">fit9</span>, <span class="kw">at</span> <span class="kw">=</span> <span class="st">"knots"</span>, <span class="kw">output</span> <span class="kw">=</span> <span class="st">"broad"</span>))
<span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">subj</span>, <span class="no">bs</span>)</pre></body></html></div>
<p>The names of the columns in <code>bs</code> correspond to the ages at which the knots are placed. The effect of the subjectâ€™s sex, gestational age and birth weight on the height SDS at the age of 2 years (here denoted by the variable named <code>2</code>) can be estimated as</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">fit1_lm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">`2`</span> ~ <span class="no">sex</span> + <span class="no">ga</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">bw</span> / <span class="fl">1000</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">fit1_lm</span>)</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = `2` ~ sex + ga + I(bw/1000), data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.86574 -0.48700  0.07829  0.65945  2.05699 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  0.95095    1.49030   0.638 0.524161    
## sexmale     -0.01342    0.13019  -0.103 0.917980    
## ga          -0.06930    0.04389  -1.579 0.115977    
## I(bw/1000)   0.55696    0.14392   3.870 0.000148 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.8909 on 196 degrees of freedom
## Multiple R-squared:  0.07922,    Adjusted R-squared:  0.06512 
## F-statistic: 5.621 on 3 and 196 DF,  p-value: 0.001023</code></pre>
<p>Note that the analysis shows there is a substantial effect of birth weight. Of course, it might be that birth weight is directly related to height at the age of 2 years. Alternatively, the relation could be mediated by birth length. The following model adds birth length (the variable named <code>0</code>) to the model:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">fit2_lm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(<span class="no">`2`</span> ~ <span class="no">sex</span> + <span class="no">ga</span> + <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span>(<span class="no">bw</span> / <span class="fl">1000</span>) + <span class="no">`0`</span>, <span class="kw">data</span> <span class="kw">=</span> <span class="no">data</span>)
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">fit2_lm</span>)</pre></body></html></div>
<pre><code>## 
## Call:
## lm(formula = `2` ~ sex + ga + I(bw/1000) + `0`, data = data)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.91356 -0.54407  0.05763  0.60230  1.89573 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)   
## (Intercept)  3.17543    1.68312   1.887  0.06070 . 
## sexmale     -0.02664    0.12825  -0.208  0.83568   
## ga          -0.08897    0.04382  -2.031  0.04365 * 
## I(bw/1000)   0.15998    0.20433   0.783  0.43460   
## `0`          0.24697    0.09160   2.696  0.00763 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 0.877 on 195 degrees of freedom
## Multiple R-squared:  0.1123, Adjusted R-squared:  0.0941 
## F-statistic: 6.168 on 4 and 195 DF,  p-value: 0.0001079</code></pre>
<p>The effect of birth length on length at age 2 is very strong. There is no separate effect of birth weight anymore, so this analysis suggests that the relation between birth weight and length at age 2 can be explained by their mutual associations to birth length.</p>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>This vignette illustrated the use of the <code><a href="../reference/brokenstick.html">brokenstick()</a></code>, <code><a href="https://rdrr.io/r/base/plot.html">plot()</a></code> and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> functions. Other vignettes highlight various other capabilities of the package.</p>
<ul>
<li>
<a href="prediction.html">Fit and predict</a>
<ul>
<li>Data exploration</li>
<li>Conversion back and forth to the Z-score scale</li>
<li>Export and publish a broken stick model</li>
<li>Predict growth curve of new subjects</li>
<li>Assess the quality of the model</li>
</ul>
</li>
<li>
<a href="model.html">Model formulation</a>
<ul>
<li>Definition of the model</li>
<li>Interpretation of the model</li>
</ul>
</li>
<li>
<a href="perfectmodel.html">Perfect model</a>
<ul>
<li>Properties of the perfect model</li>
<li>Estimating time-to-time correlations</li>
</ul>
</li>
<li>
<a href="knotplacement.html">Knot placement</a>
<ul>
<li>Knot placement advice</li>
</ul>
</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Stef van Buuren.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
