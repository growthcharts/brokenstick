<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The brokenstick() function fits an irregularly observed series
of measurements onto a user-specified grid of points (knots).
The model codes the grid by a series of linear B-splines.
Each modelled trajectory consists of straight lines that join at
the chosen knots and look like a broken stick. Differences between
observations are expressed by a random effect per knot."><title>Fit a brokenstick model to irregular data — brokenstick • brokenstick</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a brokenstick model to irregular data — brokenstick"><meta property="og:description" content="The brokenstick() function fits an irregularly observed series
of measurements onto a user-specified grid of points (knots).
The model codes the grid by a series of linear B-splines.
Each modelled trajectory consists of straight lines that join at
the chosen knots and look like a broken stick. Differences between
observations are expressed by a random effect per knot."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">brokenstick</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/brokenstick.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/mainfunctions.html">Overview of main functions</a>
    <a class="dropdown-item" href="../articles/manual/manual.html">Broken Stick Model for Irregular Longitudinal Data</a>
    <a class="dropdown-item" href="../articles/perfectmodel.html">Check perfect model</a>
    <a class="dropdown-item" href="../articles/oldfriends.html">Help for old friends</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/growthcharts/brokenstick/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Fit a <code>brokenstick</code> model to irregular data</h1>
      <small class="dont-index">Source: <a href="https://github.com/growthcharts/brokenstick/blob/HEAD/R/brokenstick.R" class="external-link"><code>R/brokenstick.R</code></a></small>
      <div class="d-none name"><code>brokenstick.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>brokenstick()</code> function fits an irregularly observed series
of measurements onto a user-specified grid of points (knots).
The model codes the grid by a series of linear B-splines.
Each modelled trajectory consists of straight lines that join at
the chosen knots and look like a broken stick. Differences between
observations are expressed by a random effect per knot.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">brokenstick</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  knots <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  boundary <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5L</span>,</span>
<span>  degree <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kr"</span>, <span class="st">"lmer"</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="set_control.html">set_control</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">method</span>, <span class="va">...</span><span class="op">)</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.exclude</span>,</span>
<span>  light <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>formula</dt>
<dd><p>A formula specifying the outcome, the predictor and the group
variable in <code>data</code>. The generic shape is <code>formula = y ~ x | group</code>. The
left-hand side is the outcome, the right-hand side the predictor, and the
name of the grouping variable occurs after the <code>|</code> sign. Formula treatment
is non-standard: 1) <code>y</code> and <code>x</code> should be numeric, 2) only one variable
is allowed in each model term (additional variables will be ignored).</p></dd>


<dt>data</dt>
<dd><p>A data frame or matrix containing the outcome (numeric),
predictor (numeric) and group (numeric, factor, character) variable.</p></dd>


<dt>knots</dt>
<dd><p>Optional, but recommended. Numerical vector with the
locations of the internal knots to be placed on the values of the predictor.
The function sorts the internal knots in increasing order.</p></dd>


<dt>boundary</dt>
<dd><p>Optional, but recommended. Numerical vector of
length 2 with the left and right boundary knot. The <code>boundary</code>
setting is passed to <code><a href="https://rdrr.io/r/splines/bs.html" class="external-link">splines::bs()</a></code> as the <code>Boundary.knots</code> argument.
If not specified, the function determines the boundary knots as
<code>range(x)</code>. When specified, the <code>boundary</code> range is internally
expanded to include at least <code>range(knots)</code>.</p></dd>


<dt>k</dt>
<dd><p>Optional, a convenience parameter for the number of
internal knots. If specified, then <code>k</code> internal knots are placed
at equidense quantiles of the predictor. For example,
specifying <code>k = 1</code> puts a knot at the 50th quantile (median),
setting <code>k = 3</code> puts knots at the 25th, 50th and 75th quantiles,
and so on. If the user specifies both <code>k</code> and <code>knots</code> arguments
then <code>knots</code> takes precedence. The default is <code>k = 5</code>, so if the user
does not specify any of <code>knots</code>, <code>boundary</code> or <code>k</code>, then the knots
will be at the 16th, 33th, 50th, 66th and 84th quantile of the
predictor.</p></dd>


<dt>degree</dt>
<dd><p>the degree of the spline. The broken stick model
requires linear splines, so the default is <code>degree = 1</code>.
Setting <code>degree = 0</code> yields (crisp) dummy coding, and one
column less than for <code>degree = 1</code>. The <code>brokenstick</code> package supports
only <code>degree = 0</code> and <code>degree = 1</code>.</p></dd>


<dt>method</dt>
<dd><p>Estimation method. Either <code>"kr"</code> (for the
Kasim-Raudenbush sampler) or <code>"lmer"</code> (for <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code>).
Version 1.1.1.9000 changed the default to <code>method = "kr"</code>.</p></dd>


<dt>control</dt>
<dd><p>List of control options returned by <code><a href="set_control.html">set_control()</a></code> used
to set algorithmic details. A list with parameters. When not specified,
the functions sets to defaults
for method <code>"kr"</code> by <code><a href="control_kr.html">control_kr()</a></code>, and
for method <code>"lmer"</code> by <code><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html" class="external-link">lme4::lmerControl()</a></code>. For ease of use, the user
may set individual options to <code>"kr"</code> (e.g. <code>niter = 500</code>) via the ...
arguments.</p></dd>


<dt>na.action</dt>
<dd><p>A function that indicates what <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> should so
when the data contain <code>NA</code>s. Default set to <code>na.exclude</code>. Only used by
method <code>"lmer"</code>.</p></dd>


<dt>light</dt>
<dd><p>Should the returned object be lighter? If <code>light = TRUE</code>
the returned object will contain only the model settings and parameter
estimates and not store the <code>data</code>, <code>imp</code> and <code>mod</code> elements. The light
object can be used to predict broken stick estimates for new data, but
does not disclose the training data and is very small (often &lt;20 Kb).</p></dd>


<dt>...</dt>
<dd><p>Forwards arguments to <code><a href="control_kr.html">control_kr()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A object of class <code>brokenstick</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The choice between <code>method = "kr"</code> and <code>method = "lmer"</code> depends on the size
of the data and the complexity of the model. In general, setting <code>method = "lmer"</code>
can require substantial calculation time for more complex models
(say &gt; 8 internal knots) and may not converge. Method <code>"kr"</code> is less
sensitive to model complexity and small samples, and has the added benefit that the
variance-covariance matrix of the random effects can be constrained through the
<code>cormodel</code> argument. On the other hand, <code>"lmer"</code> is the better-researched
method, and is more efficient for simpler models and datasets with many
rows.</p>
<p>The default algorithm since version 2.0 is the Bayesian Kasim-Raudenbush
sampler (<code>method = "kr"</code>). The variance-covariance matrix of the broken stick
estimates absorbs the relations over time. The <code>"kr"</code> method allows
enforcing a simple structure on this variance-covariance matrix. Currently,
there are three such correlation models: <code>"none"</code> (default), <code>"argyle"</code>
and <code>"cole"</code>. Specify the <code>seed</code> argument for reproducibility.
See <code><a href="control_kr.html">control_kr()</a></code> for more details.</p>
<p>The alternative <code>method = "lmer"</code> fits the broken stick model by
<code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code>. With this method, the variance-covariance matrix can only be
unstructured. This estimate may be unstable if the number of children is
small relative to the number of specified knots. The default setting
in <code><a href="https://rdrr.io/pkg/lme4/man/lmerControl.html" class="external-link">lme4::lmerControl()</a></code> is  <code>check.nobs.vs.nRE= "stop"</code>. The
<code>[set_control()]</code> function changes this to <code>check.nobs.vs.nRE= "warning"</code>
by default, since otherwise many broken stick models would not run at all.
The method throws warnings that estimates are not stable. It can be time
for models with many internal knots. Despite the warnings,
the results often look reasonable.</p>
<p>Diagnostics with <span class="pkg">coda</span> and <span class="pkg">lme4</span>: The function returns an object
of class <code>brokenstick</code>. For <code>method = "kr"</code> the list component named
<code>"mod"</code> contains a list of <code>mcmc</code> objects that can be further analysed with
<code><a href="https://rdrr.io/pkg/coda/man/trellisplots.html" class="external-link">coda::acfplot()</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/autocorr.html" class="external-link">coda::autocorr()</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/crosscorr.html" class="external-link">coda::crosscorr()</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/cumuplot.html" class="external-link">coda::cumuplot()</a></code>,
<code><a href="https://rdrr.io/pkg/coda/man/densplot.html" class="external-link">coda::densplot()</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/effectiveSize.html" class="external-link">coda::effectiveSize()</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/geweke.plot.html" class="external-link">coda::geweke.plot()</a></code>,
<code><a href="https://rdrr.io/pkg/coda/man/raftery.diag.html" class="external-link">coda::raftery.diag()</a></code>, <code><a href="https://rdrr.io/pkg/coda/man/traceplot.html" class="external-link">coda::traceplot()</a></code> and the usual <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>
and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> functions. For <code>method = "lmer"</code> the list component named
<code>"mod"</code> contains an object of class <a href="https://rdrr.io/pkg/lme4/man/merMod-class.html" class="external-link">lme4::merMod</a>. These model objects
are omitted in light <code>brokenstick</code> objects.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>Note that automatic knot specification is data-dependent, and may not reproduce
on other data. Likewise, knots specified via <code>k</code> are data-dependent and do not transfer
to other  data sets. Fixing the model requires specifying both <code>knots</code> and
<code>boundary</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">smocc_200</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">1198</span>, <span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using kr method, default</span></span></span>
<span class="r-in"><span><span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu">brokenstick</span><span class="op">(</span><span class="va">hgt_z</span> <span class="op">~</span> <span class="va">age</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">data</span>, knots <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f1</span>, <span class="va">data</span>, n_plot <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># study sampling behaviour of the sigma2 parameter with coda</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st">"coda"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="va">mod</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/trellisplots.html" class="external-link">acfplot</a></span><span class="op">(</span><span class="va">f1</span><span class="op">$</span><span class="va">mod</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using lmer method</span></span></span>
<span class="r-in"><span><span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu">brokenstick</span><span class="op">(</span><span class="va">hgt_z</span> <span class="op">~</span> <span class="va">age</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">data</span>, knots <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, method <span class="op">=</span> <span class="st">"lmer"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Model failed to converge with max|grad| = 0.00940367 (tol = 0.002, component 1)</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f2</span>, <span class="va">data</span>, n_plot <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># drill down into merMod object with standard diagnostics in lme4</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">f2</span><span class="op">$</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Linear mixed model fit by REML ['lmerMod']</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Formula: hgt_z ~ 0 + age_0 + age_1 + age_2 + age_3 + (0 + age_0 + age_1 +  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     age_2 + age_3 | id)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Data: data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Control: control</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> REML criterion at convergence: 2087.9</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Scaled residuals: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -3.8279 -0.5272  0.0031  0.5705  3.4223 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Random effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Groups   Name  Variance Std.Dev. Corr          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  id       age_0 1.2931   1.1372                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           age_1 0.6759   0.8221   0.47          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           age_2 0.7065   0.8405   0.45 0.94     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           age_3 5.2058   2.2816   0.44 0.52 0.65</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Residual       0.1783   0.4223                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of obs: 1185, groups:  id, 124</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fixed effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       Estimate Std. Error t value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_0 -0.02586    0.10453  -0.247</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_1  0.03509    0.07837   0.448</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_2  0.05964    0.08669   0.688</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_3  0.66582    1.08567   0.613</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Correlation of Fixed Effects:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       age_0  age_1  age_2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_1  0.407              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_2  0.396  0.722       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age_3  0.072  0.139 -0.134</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> optimizer (nloptwrap) convergence code: 0 (OK)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model failed to converge with max|grad| = 0.00940367 (tol = 0.002, component 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f2</span><span class="op">$</span><span class="va">mod</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># a model with more knots</span></span></span>
<span class="r-in"><span><span class="va">knots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">6</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">15</span>, <span class="fl">18</span>, <span class="fl">24</span>, <span class="fl">36</span><span class="op">)</span> <span class="op">/</span> <span class="fl">12</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># method kr takes about 2 seconds</span></span></span>
<span class="r-in"><span><span class="va">f3</span> <span class="op">&lt;-</span> <span class="fu">brokenstick</span><span class="op">(</span><span class="va">hgt_z</span> <span class="op">~</span> <span class="va">age</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">data</span>, <span class="va">knots</span>, seed <span class="op">=</span> <span class="fl">222</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f3</span>, <span class="va">data</span>, n_plot <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># method lmer takes about 40 seconds</span></span></span>
<span class="r-in"><span><span class="va">f4</span> <span class="op">&lt;-</span> <span class="fu">brokenstick</span><span class="op">(</span><span class="va">hgt_z</span> <span class="op">~</span> <span class="va">age</span> <span class="op">|</span> <span class="va">id</span>, <span class="va">data</span>, <span class="va">knots</span>, method <span class="op">=</span> <span class="st">"lmer"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>number of observations (=1185) &lt;= number of random effects (=1364) for term (0 + age_0 + age_0.0833 + age_0.1667 + age_0.25 + age_0.5 + age_0.75 + age_1 + age_1.25 + age_1.5 + age_2 + age_3 | id); the random-effects parameters and the residual variance (or scale parameter) are probably unidentifiable</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> boundary (singular) fit: see help('isSingular')</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">f4</span>, <span class="va">data</span>, n_plot <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="brokenstick-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by <a href="https://stefvanbuuren.name" class="external-link">Stef van Buuren</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer></div>

  

  

  </body></html>

